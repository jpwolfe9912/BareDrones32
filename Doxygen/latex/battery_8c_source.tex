\hypertarget{battery_8c_source}{}\doxysection{battery.\+c}
\label{battery_8c_source}\index{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/battery.c@{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/battery.c}}
\mbox{\hyperlink{battery_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{board_8h}{board.h}}"{}}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00011}00011 \textcolor{comment}{/* Global Functions */}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00012}\mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{00012}} \textcolor{keywordtype}{float} \mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{battVoltage}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00013}\mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{00013}} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862}{battCells\_e}} \mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00014}\mbox{\hyperlink{battery_8c_ab7ebcda2eb57227df52a41b5f8c306b2}{00014}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{battery_8c_ab7ebcda2eb57227df52a41b5f8c306b2}{battLow}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00015}\mbox{\hyperlink{battery_8c_a04b408c49d3fb293aacb6f23bf88b3a1}{00015}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{battery_8c_a04b408c49d3fb293aacb6f23bf88b3a1}{battEmpty}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00017}00017 \textcolor{comment}{/* Static Function Prototypes */}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00018}00018 \textcolor{keyword}{static} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862}{battCells\_e}} batt\_cells(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00019}00019 \textcolor{keyword}{static} \textcolor{keywordtype}{void} batt\_warning(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00025}00025 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00026}\mbox{\hyperlink{battery_8c_a5e2a9ae61a1cebe35fe0fa20b91c57c8}{00026}} \mbox{\hyperlink{battery_8c_a5e2a9ae61a1cebe35fe0fa20b91c57c8}{battMonInit}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00027}00027 \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00028}00028     \mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}} = batt\_cells();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00029}00029     \textcolor{keywordflow}{if}(\mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}} != 0)}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00030}00030         printf(\textcolor{stringliteral}{"{}\(\backslash\)n\%d cells detected\(\backslash\)n"{}}, \mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00031}00031     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00032}00032         printf(\textcolor{stringliteral}{"{}\(\backslash\)nNo battery detected\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00033}00033 \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00039}00039 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00040}\mbox{\hyperlink{battery_8c_a597d861d523b1711af5e13d421ceac25}{00040}} \mbox{\hyperlink{battery_8c_a597d861d523b1711af5e13d421ceac25}{battMonRead}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00041}00041 \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00042}00042     \mbox{\hyperlink{drv__adc_8c_a27db3660a4a85bd60564505cdad37fb0}{adc1Ch8Start}}();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00043}00043     \mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{battVoltage}} = *\mbox{\hyperlink{drv__adc_8c_a5af95b023f58b843986d1f74f3f71df8}{rawADC}} * 0.0088623f;}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00044}00044     batt\_warning();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00045}00045 \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00051}00051 \textcolor{keyword}{static} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862}{battCells\_e}}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00052}00052 batt\_cells(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00053}00053 \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00054}00054     \textcolor{keywordtype}{float} summedVoltage = 0;}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00055}00055     \textcolor{keywordtype}{float} avgVoltage = 0;}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00056}00056     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < 10; i++)}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00057}00057     \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00058}00058         \mbox{\hyperlink{battery_8c_a597d861d523b1711af5e13d421ceac25}{battMonRead}}();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00059}00059         summedVoltage += \mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{battVoltage}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00060}00060         \mbox{\hyperlink{drv__system_8c_a7f2dfce1046bdd2a2b753643726c2346}{delay}}(1);}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00061}00061     \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00062}00062     avgVoltage = summedVoltage / 10.0f;}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00063}00063 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00064}00064     \textcolor{keywordflow}{if}((avgVoltage >= 10.0f) \&\& (avgVoltage < 13.3))}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00065}00065         \textcolor{keywordflow}{return} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862a1251fbf93888ad32fe0ae54d49bcef17}{THREE}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00066}00066     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((avgVoltage >= 13.3) \&\& (avgVoltage < 17.15))}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00067}00067         \textcolor{keywordflow}{return} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862a23d7ef5341c6930d19b2ecbb997977cf}{FOUR}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00068}00068     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((avgVoltage >= 17.15) \&\& (avgVoltage < 21))}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00069}00069         \textcolor{keywordflow}{return} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862a3a40d11d30db182ab8f9846aa9458bec}{FIVE}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00070}00070     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(avgVoltage >= 21)}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00071}00071         \textcolor{keywordflow}{return} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862aadffddd32c3e7497e32cd7e430c9c106}{SIX}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00072}00072     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00073}00073         \textcolor{keywordflow}{return} \mbox{\hyperlink{battery_8h_a065db3c6827b30adb091f74d479ed862a5aae27054572160c56fe3ae2aea1745a}{NO\_BATT}};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00075}00075 \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00081}00081 \textcolor{keyword}{static} \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00082}00082 batt\_warning(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00083}00083 \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00084}00084     \textcolor{keywordflow}{if}(\mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}} != 0)}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00085}00085     \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00086}00086         \textcolor{keywordflow}{if}(\mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{battVoltage}} < (\mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}} * 3.5))\{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00087}00087             \mbox{\hyperlink{drv__color_8c_a51793d1b3d6e4669841c63ba39e428ce}{color}}(\mbox{\hyperlink{drv__color_8h_a0a204139fa728b63f637526a181ca979af80f9a890089d211842d59625e561f88}{RED}}, \mbox{\hyperlink{drv__color_8h_a3754b48ed3011b2b338eb948daa47cd7a99f136a862ba5c7d16967231c29f09d6}{YES}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00088}00088             printf(\textcolor{stringliteral}{"{}\(\backslash\)nBATTERY EMPTY\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00089}00089             \mbox{\hyperlink{drv__color_8c_aa926233cbec85dc0871fdf95d7406dbe}{colorDefault}}();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00090}00090             \mbox{\hyperlink{battery_8c_a04b408c49d3fb293aacb6f23bf88b3a1}{battEmpty}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00091}00091         \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00092}00092         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{battery_8c_a855408c36f973de1305b920c1e2d7125}{battVoltage}} < (\mbox{\hyperlink{battery_8c_acaa90e358397010f1098d4c1fbcf3566}{cells}} * 3.7))\{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00093}00093             \mbox{\hyperlink{drv__color_8c_a51793d1b3d6e4669841c63ba39e428ce}{color}}(\mbox{\hyperlink{drv__color_8h_a0a204139fa728b63f637526a181ca979ae735a848bf82163a19236ead1c3ef2d2}{YELLOW}}, \mbox{\hyperlink{drv__color_8h_a3754b48ed3011b2b338eb948daa47cd7a99f136a862ba5c7d16967231c29f09d6}{YES}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00094}00094             printf(\textcolor{stringliteral}{"{}\(\backslash\)nBATTERY LOW\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00095}00095             \mbox{\hyperlink{drv__color_8c_aa926233cbec85dc0871fdf95d7406dbe}{colorDefault}}();}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00096}00096             \mbox{\hyperlink{battery_8c_ab7ebcda2eb57227df52a41b5f8c306b2}{battLow}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00097}00097         \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00098}00098         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00099}00099         \{}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00100}00100             \mbox{\hyperlink{battery_8c_ab7ebcda2eb57227df52a41b5f8c306b2}{battLow}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00101}00101             \mbox{\hyperlink{battery_8c_a04b408c49d3fb293aacb6f23bf88b3a1}{battEmpty}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00102}00102         \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00103}00103     \}}
\DoxyCodeLine{\Hypertarget{battery_8c_source_l00104}00104 \}}

\end{DoxyCode}
